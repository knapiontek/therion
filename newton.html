<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css" integrity="sha384-wE+lCONuEo/QSfLb4AfrSk7HjWJtc4Xc1OiB2/aDBzHzjnlBP4SX7vjErTcwlA8C" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js" integrity="sha384-tdtuPw3yx/rnUGmnLNWXtfjb9fpmwexsd+lr6HUYnUY4B7JhB5Ty7a1mYd+kto/s" crossorigin="anonymous"></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style>
#main_page {
    padding: 2cm;
    width: 19cm;
    margin-left: auto;
    margin-right: auto;
    background-color: #ffffff;
    box-shadow: 10px 10px 5px #888888;
}
body {
    background-color: #cccccc;
    font: 14px Myriad,Helvetica,Tahoma,Arial,clean,sans-serif;
    font-size: 0.8em;
    line-height: 1.5em;
    margin-top: 1.5em;
    margin-bottom: 1.5em;
}
#system {
    width: 100%;
    margin: 0 auto;
    border: thin solid;
}
</style>
</head>
<body>
<div id="main_page">
    <h3>Newton Dynamics</h3>
    <div class="math">\vec{F}=m\frac{\partial^2\vec{x}}{\partial t^2}</div>
    <h3>Law Of Gravitation</h3>
    <div class="math">F=G\frac{Mm}{r^2}</div>
    <h3>Stellar System Simulation</h3>
    <div><canvas id='system'></div>
    <h3>Solution</h3>
    <p>from geometry</p>
    <div class="math">\vec{x}=\begin{bmatrix}x_1&x_2\end{bmatrix}^T</div>
    <div class="math">\vec{F}=\begin{bmatrix}-F_1&-F_2\end{bmatrix}^T</div>
    <div class="math">\begin{matrix}\frac{F_1}{F}=\frac{x_1}{r}&\frac{F_2}{F}=\frac{x_2}{r}\end{matrix}</div>
    <p>we get</p>
    <div class="math">\frac{\partial^2\vec{x_{n+1}}}{\partial t^2}=\vec{a_{n+1}}=\frac{\vec{F_{n+1}}}{m}=GM\frac{\vec{x_n}}{r^3}</div>
    <div class="math">\frac{\partial\vec{x_{n+1}}}{\partial t}=\vec{v_{n+1}}=\vec{v_0}+\sum_{i=1}^{i=n}\vec{a_i}\Delta t</div>
    <div class="math">\vec{x_{n+1}}=\vec{x_0}+\sum_{i=1}^{i=n}\vec{v_i}\Delta t</div>
</div>
<script>
var G = 500
var delta = 0.05
var size = 1000
var planet_seq = [{ r: 20.0, x: 500, y: 500, vx: 0, vy: 0 },
                  { r: 2.0, x: 200, y: 200, vx: 35, vy: -5 },
                  { r: 1.5, x: 300, y: 300, vx: 35, vy: -25 },
                  { r: 2.5, x: 850, y: 800, vx: -35, vy: 5 },
                  { r: 1.0, x: 400, y: 400, vx: -45, vy: 40 }]
function mass(r) {
    return Math.PI * r * r
}
function radius(m) {
    return Math.sqrt(m) / Math.PI
}
function render_katex() {
    $(".math").each(function() {
        var texTxt = $(this).text()
        elem = $(this).get(0)
        try {
            katex.render(texTxt, elem, { displayMode: true })
        }
        catch(err) {
            $(this).html("<span class='err'>" + err)
        }
    })
}
function render() {
    var system = $('#system').get(0)
    var context = system.getContext('2d')
    system.width = size
    system.height = size
    context.clearRect(0, 0, system.width, system.height)
    for(var i = 0; i < planet_seq.length; i++) {
        planet = planet_seq[i]
        if(planet != 'null') {
            context.beginPath()
            context.arc(planet.x, planet.y, 4 * planet.r, 0, 2 * Math.PI)
            context.stroke()
        }
    }
}
function calculate() {
    for(var i1 = 0; i1 < planet_seq.length; i1++) {
        planet1 = planet_seq[i1]
        if(planet1 != 'null') {
            var ax = 0
            var ay = 0
            for(var i2 = 0; i2 < planet_seq.length; i2++) {
                if(i1 != i2) {
                    planet2 = planet_seq[i2]
                    if(planet2 != 'null') {
                        var x = planet1.x - planet2.x
                        var y = planet1.y - planet2.y
                        var r2 = (x * x) + (y * y)
                        var r = Math.sqrt(r2)
                        if(r > (planet1.r + planet2.r)) {
                            var r3 = r2 * r
                            // a ~ -x
                            ax -= G * mass(planet2.r) * x / r3
                            ay -= G * mass(planet2.r) * y / r3
                        } else if(planet1.r < planet2.r) {
                            var m1 = mass(planet1.r)
                            var m2 = mass(planet2.r)
                            var m = m1 + m2
                            planet2.r = radius(m)
                            planet2.vx = ((planet2.vx * m2) + (planet1.vx * m1)) / m
                            planet2.vy = ((planet2.vy * m2) + (planet1.vy * m1)) / m
                            // remove smaller planet
                            planet_seq[i1] = planet1 = 'null'
                            break;
                        }
                    }
                }
            }
        }
        if(planet1 != 'null') {
            planet1.vx = planet1.vx + (ax * delta)
            planet1.vy = planet1.vy + (ay * delta)
            planet1.x = planet1.x + (planet1.vx * delta)
            planet1.y = planet1.y + (planet1.vy * delta)
        }
    }
    render()
}
render_katex()
setInterval(calculate, 50)
</script>
</body>
</html>
