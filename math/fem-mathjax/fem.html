
<!DOCTYPE html>
<html>
<head>
<title>Finite Element Method by Example in Qt/C++</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
		tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
		TeX: { equationNumbers: {autoNumber: "all"} }
	});
	MathJax.Hub.Queue(function () {
		$(".left_pos").each(function(){$(this).css("left", $(this).position().left - $(this).width());});
		$(".hcenter_pos").each(function(){$(this).css("left", $(this).position().left - ($(this).width() / 2));});
		$(".above_pos").each(function(){$(this).css("top", $(this).position().top - $(this).height());});
		$(".vcenter_pos").each(function(){$(this).css("top", $(this).position().top - ($(this).height() / 2));});
	});
</script>
<style>
#main_page {
	padding: 80px;
	width: 800px;
	margin-left: auto;
	margin-right: auto;
	background-color: #ffffff;
	box-shadow: 10px 10px 5px #888888;
}
.container {
	position: relative;
}
.math {
	position: absolute;
}
.centered {
	text-align: center;
}
.shrink {
	font-size: 85%;
}
.toc1 {
	line-height: 2.5em;
}
.toc2 {
	margin: 1.5em;
}
.toc3 {
	margin: 3.0em;
}
a {
	text-decoration: none !important;
}
body {
	background-color: #cccccc;
	font: 14px Myriad,Helvetica,Tahoma,Arial,clean,sans-serif;
	font-size: 0.8em;
	line-height: 1.5em;
	margin-top: 1.5em;
	margin-bottom: 1.5em;
}
iframe {
	border: 1px solid #000000;
	width: 100%;
	height: 400px;
}
h1 {
	font-size: 2.0em;
	font-weight: normal;
	line-height: 2.5em;
	margin-top: 1em;
	margin-bottom:0.643em;
}
h2 {
	font-size: 1.6em;
	font-weight: bold;
	line-height: 1.286em;
	margin-top: 1.929em;
	margin-bottom:0.643em;
}
h3 {
	font-size: 1.2em;
	font-weight: bold;
	line-height: 1.5em;
	margin-top: 1.5em;
	margin-bottom: 0.643em;
}
</style>
</head>




<body>
<div id="main_page">

<h1 class="centered">The Finite Element Method by Example in Qt/C++</h1>
<h2 class="centered">Krzysztof Napiontek</h2>
<h3 class="centered">knapiontek@gmail.com</h3>
<h3 class="centered">Version 1.0</h3>

<h2 class="centered">Abstract</h2>

The aim of this article is help with understanding The Finite Element Method in mechanics. The theoretical part is reduced to its minimum and most of the work is focused on diagrams, graphics and examples. The relevant part of source code calculating tetrahedron truss is presented at the end of each section along with its visualized output.



<h2>Contents</h2>
<br><a class="toc1" href="#1000000">1. Introduction</a>
<br><a class="toc1" href="#2000000">2. The Concrete Example</a>
<br><a class="toc2" href="#2010000">2.1. Global Data Definition in the Example</a>
<br><a class="toc1" href="#3010000">3. The Finite Element Method</a>
<br><a class="toc2" href="#3010000">3.1. Tetrahedron Truss Breakdown</a>
<br><a class="toc2" href="#3020000">3.2. The Stiffness Matrix of an Element in Local Coordinates</a>
<br><a class="toc2" href="#3030000">3.3. Coordinate Transformation</a>
<br><a class="toc3" href="#3030100">3.3.1 Global and Local Coordinates Relations</a>
<br><a class="toc3" href="#3030200">3.3.2 The Point Displacement Relations</a>
<br><a class="toc3" href="#3030300">3.3.3 Global and Local Forces Relations</a>
<br><a class="toc2" href="#3040300">3.4. The Stiffness Matrix of an Element in Global Coordinates</a>
<br><a class="toc2" href="#3050000">3.5. Global Stiffness Matrix Aggregation</a>
<br><a class="toc2" href="#3060000">3.6. Fixing a Point Displacement</a>
<br><a class="toc2" href="#3070000">3.7. Implementation</a>
<br><a class="toc1" href="#4070000">4. Solving Linear Equations by LU Decomposition Method</a>
<br><a class="toc2" href="#4010000">4.1. Explanation</a>
<br><a class="toc2" href="#4020000">4.2. Solving an Example</a>
<br><a class="toc2" href="#4030000">4.3. Pitfalls of Direct Methods</a>
<br><a class="toc2" href="#4040000">4.4. The Concrete Example Result Presentation</a>
<br><a class="toc2" href="#4050000">4.5. Implementation of LU Decomposition Method</a>
<br><a class="toc1" href="#5050000">5. The 3D Data Presentation in the Documentation</a>
<br><a class="toc2" href="#5010000">5.1. Point Rotation</a>
<br><a class="toc2" href="#5020000">5.2. An Example of Rotated Tetrahedron</a>
<br><a class="toc2" href="#5030000">5.3. Implementation of the Rotation Procedure</a>
<br><a class="toc1" href="#6030000">6. Summary</a>



<h2 id="1000000">1. Introduction</h2>

There are many works presenting FEM, most of them very complex and comprehensive with purpose of full explanation of all details of the method. A reader who needs explanation of general idea behind finds it difficult to understand. This work tries to extract the most important aspects in a way helping to understand all knowledge almost at the first read. The relevant source code added at the end of each section calculates and visualizes the simplest 3D truss object - tetrahedron. The Hook's Law is the only equation borrowed from mechanics. There is also a need to understand trigonometry and basic matrix operations before reading.

<h2 id="2000000">2. The Concrete Example</h2>

For the purpose of this article the complete concrete example was implemented. It includes data type definitions, construction of a matrix equation, its solution and in final the presentation in graphics format. A number of dumps of the equation data have been generated for better understanding parts of implementation. The source code presented in this work was tested with Qt 5.1 in Windows environment. It does not use any platform specific code and can be easily ported to other systems.

<br><br>

The final result of the example is presented on the figure <a href="#fig:final:graphics">1</a>. It contains an original geometry of the truss, also geometry deformation by an external force and reactions in fixed points. Detailed explanation will be given in following chapters.


<a id="fig:final:graphics"/>
<div class="container">
	<div class="math below_pos hcenter_pos" style="left:230px;top:151px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:187px;top:108px;">$y$</div>
	<div class="math vcenter_pos left_pos" style="left:175px;top:160px;">$z$</div>
	<div class="math below_pos right_pos" style="left:281px;top:195px;">$p_0$</div>
	<div class="math vcenter_pos left_pos" style="left:275px;top:33px;">$p_1$</div>
	<div class="math below_pos hcenter_pos" style="left:465px;top:172px;">$p_2$</div>
	<div class="math below_pos left_pos" style="left:251px;top:247px;">$p_3$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="190" y1="148" x2="230" y2="148"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="190" y1="148" x2="190" y2="108"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="190" y1="148" x2="178" y2="160"/>
	<line stroke="black" x1="278" y1="220" x2="278" y2="61"/>
	<line stroke="black" x1="278" y1="61" x2="457" y2="222"/>
	<line stroke="black" x1="457" y1="222" x2="278" y2="220"/>
	<line stroke="black" x1="254" y1="244" x2="278" y2="220"/>
	<line stroke="black" x1="254" y1="244" x2="278" y2="61"/>
	<line stroke="black" x1="254" y1="244" x2="457" y2="222"/>
	<line stroke="black" stroke-dasharray="7,7" x1="278" y1="192" x2="278" y2="33"/>
	<line stroke="black" stroke-dasharray="7,7" x1="278" y1="33" x2="465" y2="169"/>
	<line stroke="black" stroke-dasharray="7,7" x1="465" y1="169" x2="278" y2="192"/>
	<line stroke="black" stroke-dasharray="7,7" x1="254" y1="244" x2="278" y2="192"/>
	<line stroke="black" stroke-dasharray="7,7" x1="254" y1="244" x2="278" y2="33"/>
	<line stroke="black" stroke-dasharray="7,7" x1="254" y1="244" x2="465" y2="169"/>
	<circle stroke="red" fill="red" cx="278" cy="192" r="3"/>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="278" y1="192" x2="211" y2="192"/>
	<circle stroke="red" fill="red" cx="278" cy="33" r="3"/>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="278" y1="33" x2="324" y2="28"/>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="465" y1="169" x2="461" y2="137"/>
	<circle stroke="red" fill="red" cx="254" cy="244" r="3"/>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="254" y1="244" x2="279" y2="282"/>
	<line stroke="black" x1="390" y1="30" x2="430" y2="30"/>
	<text  baseline-shift="-40%" x="433" y="30">original geometry</text>
	<line stroke="black" x1="390" y1="50" x2="430" y2="50"/>
	<text  baseline-shift="-40%" x="433" y="50">geometry deformation</text>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="390" y1="70" x2="430" y2="70"/>
	<text  baseline-shift="-40%" x="433" y="70">applied external force</text>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="390" y1="90" x2="430" y2="90"/>
	<text  baseline-shift="-40%" x="433" y="90">reactions in fixed points</text>
	<circle stroke="red" fill="red" cx="390" cy="90" r="3"/>
</svg>
<p class="centered">Figure 1: The Graphics Generated by the Example</p>

<h3 id="2010000">2.1. Global Data Definition in the Example</h3>

<iframe src="data.cpp"></iframe>

<h2 id="3010000">3. The Finite Element Method</h2>

The FEM analyse in this chapter finds relation between forces and displacements in global coordinates. At first it breaks down the truss into separate elements, finds relation of them in local coordinates using the Hook's Law and in next step it transforms it to global coordinate system for each element. Finally it aggregates all elements in one global matrix of stiffness. The lower case bold font is reserved for local and the upper case bold font for global matrices and vectors.

<h3 id="3010000">3.1. Tetrahedron Truss Breakdown</h3>

The first step of analyses requires the truss breakdown. Each element will be analysed separately and finally all of them will be aggregated in global matrix. Separation of elements is shown on the figure <a href="#fig:breakdown">2</a>.


<a id="fig:breakdown"/>
<div class="container">
	<div class="math below_pos hcenter_pos" style="left:250px;top:151px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:208px;top:107px;">$y$</div>
	<div class="math vcenter_pos left_pos" style="left:196px;top:159px;">$z$</div>
	<div class="math vcenter_pos right_pos" style="left:381px;top:129px;">$e_0$</div>
	<div class="math vcenter_pos left_pos" style="left:480px;top:126px;">$e_1$</div>
	<div class="math above_pos hcenter_pos" style="left:483px;top:218px;">$e_2$</div>
	<div class="math vcenter_pos right_pos" style="left:365px;top:236px;">$e_3$</div>
	<div class="math vcenter_pos left_pos" style="left:347px;top:153px;">$e_4$</div>
	<div class="math below_pos hcenter_pos" style="left:455px;top:252px;">$e_5$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:384px;top:220px;">$p_0$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:378px;top:37px;">$p_1$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:585px;top:222px;">$p_2$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:334px;top:264px;">$p_3$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="211" y1="147" x2="250" y2="148"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="211" y1="147" x2="211" y2="107"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="211" y1="147" x2="199" y2="159"/>
	<line stroke="red" x1="378" y1="208" x2="378" y2="49"/>
	<circle stroke="black" fill="black" cx="378" cy="208" r="3"/>
	<circle stroke="black" fill="black" cx="378" cy="49" r="3"/>
	<line stroke="red" x1="394" y1="45" x2="573" y2="206"/>
	<circle stroke="black" fill="black" cx="394" cy="45" r="3"/>
	<circle stroke="black" fill="black" cx="573" cy="206" r="3"/>
	<line stroke="red" x1="573" y1="222" x2="394" y2="220"/>
	<circle stroke="black" fill="black" cx="573" cy="222" r="3"/>
	<circle stroke="black" fill="black" cx="394" cy="220" r="3"/>
	<line stroke="red" x1="350" y1="248" x2="374" y2="224"/>
	<circle stroke="black" fill="black" cx="350" cy="248" r="3"/>
	<circle stroke="black" fill="black" cx="374" cy="224" r="3"/>
	<line stroke="red" x1="338" y1="244" x2="362" y2="61"/>
	<circle stroke="black" fill="black" cx="338" cy="244" r="3"/>
	<circle stroke="black" fill="black" cx="362" cy="61" r="3"/>
	<line stroke="red" x1="354" y1="260" x2="557" y2="238"/>
	<circle stroke="black" fill="black" cx="354" cy="260" r="3"/>
	<circle stroke="black" fill="black" cx="557" cy="238" r="3"/>
</svg>
<p class="centered">Figure 2: Truss Breakdown</p>

<h3 id="3020000">3.2. The Stiffness Matrix of an Element in Local Coordinates</h3>

Relation between axial forces $f_0, f_1$ and axial displacements $\Delta p_0, \Delta p_1$ in local coordinates in respect of the Hook's Law as depicted on the figure <a href="#fig:displacement:and:force">3</a> is described by equations \ref{eq:hook0} and \ref{eq:hook1} . Despite of 3D analyses most of the figures use 2D coordinates for simplicity.

\begin{equation}
f_0 = \frac {EA} L (\Delta p_0 - \Delta p_1)
\label{eq:hook0}
\end{equation}
\begin{equation}
f_1 = \frac {EA} L (\Delta p_1 - \Delta p_0)
\label{eq:hook1}
\end{equation}


<a id="fig:displacement:and:force"/>
<div class="container">
	<div class="math above_pos hcenter_pos" style="left:400px;top:287px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:117px;top:10px;">$y$</div>
	<div class="math above_pos hcenter_pos" style="left:187px;top:259px;">$\Delta x_0$</div>
	<div class="math vcenter_pos left_pos" style="left:144px;top:232px;">$\Delta y_0$</div>
	<div class="math above_pos hcenter_pos" style="left:187px;top:229px;">$\Delta p_0$</div>
	<div class="math below_pos hcenter_pos" style="left:147px;top:265px;">$(x_0,y_0)$</div>
	<div class="math above_pos right_pos" style="left:303px;top:87px;">$\Delta x_1$</div>
	<div class="math vcenter_pos left_pos" style="left:237px;top:70px;">$\Delta y_1$</div>
	<div class="math above_pos hcenter_pos" style="left:300px;top:67px;">$\Delta p_1$</div>
	<div class="math below_pos right_pos" style="left:243px;top:93px;">$(x_1,y_1)$</div>
	<div class="math above_pos left_pos" stroke="red" style="left:191px;top:172px;">$L$</div>
	<div class="math below_pos right_pos" stroke="red" style="left:296px;top:129px;">$L'$</div>
	<div class="math above_pos hcenter_pos" style="left:700px;top:287px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:417px;top:10px;">$y$</div>
	<div class="math above_pos hcenter_pos" style="left:490px;top:187px;">$f_{x_0}$</div>
	<div class="math vcenter_pos right_pos" style="left:523px;top:230px;">$f_{y_0}$</div>
	<div class="math below_pos hcenter_pos" style="left:490px;top:233px;">$f_0$</div>
	<div class="math vcenter_pos right_pos" style="left:523px;top:190px;">$(x_0,y_0)$</div>
	<div class="math above_pos hcenter_pos" style="left:630px;top:80px;">$f_{x_1}$</div>
	<div class="math vcenter_pos left_pos" style="left:597px;top:43px;">$f_{y_1}$</div>
	<div class="math above_pos hcenter_pos" style="left:630px;top:40px;">$f_1$</div>
	<div class="math below_pos right_pos" style="left:603px;top:86px;">$(x_1,y_1)$</div>
	<div class="math above_pos left_pos" stroke="red" style="left:557px;top:133px;">$L'$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<text  baseline-shift="-40%" x="163" y="10">a) Displacements</text>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M120 10 L120 290 L400 290" fill="none"/>
	<path stroke="black" stroke-dasharray="7,7" d="M147 201 L228 201 L228 262" fill="none"/>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M147 201 L147 262 L228 262" fill="none"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="147" y1="262" x2="228" y2="201"/>
	<path stroke="black" stroke-dasharray="7,7" d="M240 50 L360 50 L360 90" fill="none"/>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M240 50 L240 90 L360 90" fill="none"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="240" y1="90" x2="360" y2="50"/>
	<line stroke="red" x1="147" y1="262" x2="240" y2="90"/>
	<circle stroke="black" fill="black" cx="147" cy="262" r="3"/>
	<circle stroke="black" fill="black" cx="240" cy="90" r="3"/>
	<line stroke="red" stroke-dasharray="7,7" x1="228" y1="201" x2="360" y2="50"/>
	<circle stroke="black" fill="black" cx="228" cy="201" r="3"/>
	<circle stroke="black" fill="black" cx="360" cy="50" r="3"/>
	<text  baseline-shift="-40%" x="463" y="10">b) Forces</text>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M420 10 L420 290 L700 290" fill="none"/>
	<path stroke="black" stroke-dasharray="7,7" d="M460 190 L460 270 L520 270" fill="none"/>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M460 190 L520 190 L520 270" fill="none"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="520" y1="190" x2="460" y2="270"/>
	<path stroke="black" stroke-dasharray="7,7" d="M600 3 L660 3 L660 83" fill="none"/>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M600 3 L600 83 L660 83" fill="none"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="600" y1="83" x2="660" y2="3"/>
	<line stroke="red" stroke-dasharray="7,7" x1="520" y1="190" x2="600" y2="83"/>
	<circle stroke="black" fill="black" cx="520" cy="190" r="3"/>
	<circle stroke="black" fill="black" cx="600" cy="83" r="3"/>
</svg>
<p class="centered">Figure 3: Displacements (a) and Stress Forces (b) in an Element</p>

In fact the method provides only approximated solution since it assumes that angles between elements stay the same after applying external forces. In reality such approach is accepted   as long as deformations are small.

<br><br>

Using matrix notation we isolate local stiffness matrix $\mathbf{k}$.

\begin{equation}
\begin{bmatrix}
	f_0 \\
	f_1
\end{bmatrix}
= \frac {EA} L
\begin{bmatrix}
	1 & -1 \\
	-1 & 1
\end{bmatrix}
\begin{bmatrix}
	\Delta p_0 \\
	\Delta p_1
\end{bmatrix}
\end{equation}

\begin{equation}
\mathbf k = \frac {EA} L
\begin{bmatrix}
	1 & -1 \\
	-1 & 1
\end{bmatrix}
\end{equation}

The stiffness matrix represents geometry in an algebraic form. Final form of matrix equation in local coordinates shown below. Lower case bold letters reserved for local coordinates.

\begin{equation}
\mathbf{f} = \mathbf{k} \Delta \mathbf{p}
\end{equation}

<h3 id="3030000">3.3. Coordinate Transformation</h3>

In previous chapter we described relations in local coordinates. In order to aggregate all elements into global system a number of transformations have to take place.

<h3 id="3030100">3.3. Global and Local Coordinates Relations</h3>

The figure <a href="#fig:displacement:and:force">3</a>a can be used in order to describe local and global geometrical relations.

\begin{equation}
L = \sqrt { (x_1 - x_0)^2 + (y_1 - y_0)^2 + (z_1 - z_0)^2 }
\end{equation}
\begin{equation}
c_x = \cos \theta_x = \frac {x_1 - x_0} L
\end{equation}
\begin{equation}
c_y = \cos \theta_y = \frac {y_1 - y_0} L
\end{equation}
\begin{equation}
c_z = \cos \theta_z = \frac {z_1 - z_0} L
\end{equation}

<h3 id="3030200">3.3. The Point Displacement Relations</h3>

The displacement from the figure <a href="#fig:displacement:and:force">3</a>a for the point $p_0$ is broken down on the figure <a href="#fig:displacement:details">4</a>.


<a id="fig:displacement:details"/>
<div class="container">
	<div class="math above_pos hcenter_pos" style="left:530px;top:257px;">$x$</div>
	<div class="math vcenter_pos right_pos" style="left:253px;top:60px;">$y$</div>
	<div class="math below_pos hcenter_pos" style="left:390px;top:223px;">$\Delta x_0$</div>
	<div class="math vcenter_pos left_pos" style="left:287px;top:160px;">$\Delta y_0$</div>
	<div class="math above_pos hcenter_pos" stroke="red" style="left:390px;top:157px;">$\Delta p_0$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:330px;top:207px;">$\theta_x$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:466px;top:207px;">$\theta_y$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:481px;top:187px;">$\theta_x$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:481px;top:120px;">$\theta_y$</div>
	<div class="math below_pos hcenter_pos" style="left:290px;top:223px;">$(x_0,y_0)$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M250 60 L250 260 L530 260" fill="none"/>
	<path stroke="black" stroke-dasharray="7,7" d="M290 100 L490 100 L490 220" fill="none"/>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M290 100 L290 220 L490 220" fill="none"/>
	<line stroke="red" marker-end=url(#arrow-end-red) x1="290" y1="220" x2="490" y2="100"/>
	<line stroke="red" stroke-dasharray="7,7" x1="490" y1="220" x2="437" y2="131"/>
	<circle stroke="black" fill="black" cx="290" cy="220" r="3"/>
	<path stroke="black" d="M427 137 L433 147 L442 141" fill="none"/>
</svg>
<p class="centered">Figure 4: Displacement of the Point $p_0$ in Details</p>

From congruence of triangles as on the figure <a href="#fig:displacement:details">4</a> we obtain

\begin{equation}
\Delta p_0 = \Delta x_0 \cos \theta_x + \Delta y_0 \cos \theta_y + \Delta z_0 \cos \theta_z
\end{equation}
\begin{equation}
\Delta p_1 = \Delta x_1 \cos \theta_x + \Delta y_1 \cos \theta_y + \Delta z_1 \cos \theta_z
\end{equation}

In other words

\begin{equation}
\begin{bmatrix}
	\Delta p_0 \\
	\Delta p_1
\end{bmatrix}
=
\begin{bmatrix}
	c_x & c_y & c_z & 0 & 0 & 0 \\
	0 & 0 & 0 & c_x & c_y & c_z
\end{bmatrix}
\begin{bmatrix}
	\Delta x_0 \\
	\Delta y_0 \\
	\Delta z_0 \\
	\Delta x_1 \\
	\Delta y_1 \\
	\Delta z_1
\end{bmatrix}
\end{equation}

or simpler

\begin{equation}
\Delta \mathbf{p} = \mathbf{T} \Delta \mathbf{P}
\label{eq:displacement:local:vs:global}
\end{equation}

The equation \ref{eq:displacement:local:vs:global} describes displacement relation between local and global coordinates.

<h3 id="3030300">3.3. Global and Local Forces Relations</h3>

Forces given directly from geometry on the figure <a href="#fig:displacement:and:force">3</a>b

\begin{equation}
f_{x_0} = \cos \theta_x f_0
\end{equation}
\begin{equation}
f_{y_0} = \cos \theta_y f_0
\end{equation}
\begin{equation}
f_{z_0} = \cos \theta_z f_0
\end{equation}
\begin{equation}
f_{x_1} = \cos \theta_x f_1
\end{equation}
\begin{equation}
f_{y_1} = \cos \theta_y f_1
\end{equation}
\begin{equation}
f_{z_1} = \cos \theta_z f_1
\end{equation}

or in a matrix form

\begin{equation}
\begin{bmatrix}
	f_{x_0} \\
	f_{y_0} \\
	f_{z_0} \\
	f_{x_1} \\
	f_{y_1} \\
	f_{z_1}
\end{bmatrix}
=
\begin{bmatrix}
	c_x & 0 \\
	c_y & 0 \\
	c_z & 0 \\
	0 & c_x \\
	0 & c_y \\
	0 & c_z
\end{bmatrix}
\begin{bmatrix}
	f_0 \\
	f_1
\end{bmatrix}
\end{equation}

\begin{equation}
\mathbf{F = T^T f}
\label{eq:forces:local:vs:global}
\end{equation}

The equation \ref{eq:forces:local:vs:global} describes forces relation between local and global coordinates.

<h3 id="3040300">3.4. The Stiffness Matrix of an Element in Global Coordinates</h3>

Equations obtained in previous chapter: Hook's law, displacement and force relations between local and global coordinates are repeated below.

\begin{equation}
\mathbf{f} = \mathbf{k} \Delta \mathbf{p}
\end{equation}
\begin{equation}
\Delta \mathbf{p} = \mathbf{T} \Delta \mathbf{P}
\end{equation}
\begin{equation}
\mathbf{F = T^T f}
\end{equation}

It can be transformed into

\begin{equation}
\mathbf{f} = \mathbf{k} \Delta \mathbf{p}
\end{equation}
\begin{equation}
\mathbf{f} = \mathbf{k T} \Delta \mathbf{P}
\end{equation}
\begin{equation}
\mathbf{T^T f} = \mathbf{T^T k T} \Delta \mathbf{P}
\end{equation}
\begin{equation}
\mathbf{F} = \mathbf{T^T k T} \Delta \mathbf{P}
\end{equation}

Finally the extracted version of global stiffness matrix $\mathbf{K}$ in global coordinates takes form

\begin{equation}
\mathbf{K} = \mathbf{T^T k T} = \frac {EA} L
\begin{bmatrix}
	c^2_x & c_xc_y & c_xc_z & -c^2_x & -c_xc_y & -c_xc_z \\
	c_xc_y & c^2_y & c_yc_z & -c_xc_y & -c^2_y & -c_yc_z \\
	c_xc_z & c_yc_z & c^2_z & -c_xc_z & -c_yc_z & -c^2_z \\
	-c^2_x & -c_xc_y & -c_xc_z & c^2_x & c_xc_y & c_xc_z \\
	-c_xc_y & -c^2_y & -c_yc_z & c_xc_y & c^2_y & c_yc_z \\
	-c_xc_z & -c_yc_z & -c^2_z & c_xc_z & c_yc_z & c^2_z
\end{bmatrix}
\end{equation}

so the main equation of this work is formed as

\begin{equation}
\mathbf{F} = \mathbf{K} \Delta \mathbf{P}
\label{eq:main}
\end{equation}

and describes relation of global forces and deformation of whole truss geometry.

<h3 id="3050000">3.5. Global Stiffness Matrix Aggregation</h3>

Let's form equation \ref{eq:main} for an element $e_2(p_0,p_2)$ in Global Stiffness Matrix. The element index for cosines is omitted for simplicity ($c_x$ instead of $c_{2_x}$ etc.).

\begin{equation}
\frac {EA} L
\begin{bmatrix}
	c^2_x & c_xc_y & c_xc_z & . & . & . & -c^2_x & -c_xc_y & -c_xc_z & . & . & . \\
	c_xc_y & c^2_y & c_yc_z & . & . & . & -c_xc_y & -c^2_y & -c_yc_z & . & . & . \\
	c_xc_z & c_yc_z & c^2_z & . & . & . & -c_xc_z & -c_yc_z & -c^2_z & . & . & . \\
	. & . & . & . & . & . & . & . & . & . & . & . \\
	. & . & . & . & . & . & . & . & . & . & . & . \\
	. & . & . & . & . & . & . & . & . & . & . & . \\
	-c^2_x & -c_xc_y & -c_xc_z & . & . & . & c^2_x & c_xc_y & c_xc_z & . & . & . \\
	-c_xc_y & -c^2_y & -c_yc_z & . & . & . & c_xc_y & c^2_y & c_yc_z & . & . & . \\
	-c_xc_z & -c_yc_z & -c^2_z & . & . & . & c_xc_z & c_yc_z & c^2_z & . & . & . \\
	. & . & . & . & . & . & . & . & . & . & . & . \\
	. & . & . & . & . & . & . & . & . & . & . & . \\
	. & . & . & . & . & . & . & . & . & . & . & .
\end{bmatrix}
\begin{bmatrix}
	\Delta x_0 \\
	\Delta y_0 \\
	\Delta z_0 \\
	. \\
	. \\
	. \\
	\Delta x_2 \\
	\Delta y_2 \\
	\Delta z_2 \\
	. \\
	. \\
	.
\end{bmatrix}
=
\begin{bmatrix}
	f_{x_0} \\
	f_{y_0} \\
	f_{z_0} \\
	. \\
	. \\
	. \\
	f_{x_2} \\
	f_{y_2} \\
	f_{z_2} \\
	. \\
	. \\
	.
\end{bmatrix}
\label{eq:detail:K:element}
\end{equation}

By substituting parts of above equation by

\begin{equation}
k_2 = \frac {EA} L
\begin{bmatrix}
	c^2_x & c_xc_y & c_xc_z \\
	c_xc_y & c^2_y & c_yc_z \\
	c_xc_z & c_yc_z & c^2_z
\end{bmatrix}
\;\;\;\;\;
\Delta p_i =
\begin{bmatrix}
	\Delta x_i \\
	\Delta y_i \\
	\Delta z_i
\end{bmatrix}
\;\;\;\;\;
f_i =
\begin{bmatrix}
	f_{x_i} \\
	f_{y_i} \\
	f_{z_i}
\end{bmatrix}
\end{equation}

we obtain simpler form ready for further analysis

\begin{equation}
\begin{bmatrix}
	k_2 & . & -k_2 & . \\
	. & . & . & . \\
	-k_2 & . & k_2 & . \\
	. & . & . & .
\end{bmatrix}
\begin{bmatrix}
	\Delta p_0 \\
	. \\
	\Delta p_2 \\
	.
\end{bmatrix}
=
\begin{bmatrix}
	f_0 \\
	. \\
	f_2 \\
	.
\end{bmatrix}
\end{equation}

\begin{equation}
\mathbf{K_2} \Delta \mathbf{P} = \mathbf{F_2}
\end{equation}

The sum of all directional forces based on the condition of equilibrium in a point is equal zero

\begin{equation}
\sum \mathbf{F_x} = 0\;\;\;\;\;\sum \mathbf{F_y} = 0\;\;\;\;\;\sum \mathbf{F_z} = 0
\end{equation}


<a id="fig:point0:forces"/>
<div class="container">
	<div class="math vcenter_pos hcenter_pos" style="left:282px;top:89px;">$R_x$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:417px;top:90px;">$S_x$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:350px;top:22px;">$R_y$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:350px;top:157px;">$S_y$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:375px;top:64px;">$R_z$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:322px;top:117px;">$S_z$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:361px;top:102px;">$p_0$</div>
</div>
<svg width="800" height="170">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<line stroke="red" marker-start=url(#arrow-start-red) marker-end=url(#arrow-end-red) x1="290" y1="89" x2="409" y2="90"/>
	<line stroke="red" marker-start=url(#arrow-start-red) marker-end=url(#arrow-end-red) x1="350" y1="30" x2="350" y2="149"/>
	<line stroke="red" marker-start=url(#arrow-start-red) marker-end=url(#arrow-end-red) x1="371" y1="68" x2="328" y2="111"/>
</svg>
<p class="centered">Figure 5: Force Equilibrium in the Point $p_0$, <b>R</b>eactions and <b>S</b>tresses</p>

and displacement in the point is the same for all elements based on it. So we can write down

\begin{equation}
\sum\limits_{e=1}^n \mathbf{K_e} \Delta \mathbf{P} = \sum\limits_{e=1}^n \mathbf{F_e}\;\;\;\;\;\mbox{e - index of an element}
\end{equation}

Finally the simplified form of $\mathbf{K}$ for all elements (aggregation with collocation)

\begin{equation}
\begin{bmatrix}
	k_0 + \color{green}{k_2} + \color{blue}{k_3} & -k_0 & \color{green}{-k_2} & \color{blue}{-k_3} \\
	-k_0 & k_0 + \color{red}{k_1} + \color{cyan}{k_4} & \color{red}{-k_1} & \color{cyan}{-k_4} \\
	\color{green}{-k_2} & \color{red}{-k_1} & \color{red}{k_1} + \color{green}{k_2} + k_5 & -k_5 \\
	\color{blue}{-k_3} & \color{cyan}{-k_4} & -k_5 & \color{blue}{k_3} + \color{cyan}{k_4} + k_5
\end{bmatrix}
\begin{bmatrix}
	\Delta p_0 \\
	\Delta p_1 \\
	\Delta p_2 \\
	\Delta p_3
\end{bmatrix}
=
\begin{bmatrix}
	f_0 \\
	f_1 \\
	f_2 \\
	f_3
\end{bmatrix}
\end{equation}

The aggregated version of equation \ref{eq:detail:K:element} is omitted here due to a poor readability.

<br><br>

The numerical version of the stiffness matrix with no forces applied as generated by the concrete example

<div class="shrink">
\begin{equation}

\begin{bmatrix}
222.2 & . & . & . & . & . & -222.2 & . & . & . & . & . \\
. & 250 & . & . & -250 & . & . & . & . & . & . & . \\
. & . & 166.7 & . & . & . & . & . & . & . & . & -166.7 \\
. & . & . & 92.78 & -82.47 & . & -92.78 & 82.47 & . & . & . & . \\
. & -250 & . & -82.47 & 366 & -64 & 82.47 & -73.31 & . & . & -42.67 & 64 \\
. & . & . & . & -64 & 96.01 & . & . & . & . & 64 & -96.01 \\
-222.2 & . & . & -92.78 & 82.47 & . & 363 & -82.47 & -64 & -48 & . & 64 \\
. & . & . & 82.47 & -73.31 & . & -82.47 & 73.31 & . & . & . & . \\
. & . & . & . & . & . & -64 & . & 85.33 & 64 & . & -85.33 \\
. & . & . & . & . & . & -48 & . & 64 & 48 & . & -64 \\
. & . & . & . & -42.67 & 64 & . & . & . & . & 42.67 & -64 \\
. & . & -166.7 & . & 64 & -96.01 & 64 & . & -85.33 & -64 & -64 & 348
\end{bmatrix}
\begin{bmatrix}
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
.
\end{bmatrix}=
\begin{bmatrix}
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
.
\end{bmatrix}

\end{equation}
</div>

<h3 id="3060000">3.6. Fixing a Point Displacement</h3>

Determinant of matrix $\mathbf{K}$ constructed in previous chapter is equal zero.

\begin{equation}
det(\mathbf{K}) = 0
\end{equation}

It means there is no unique solution and the truss is statically unstable. Applying external force does not cause any reaction. In order to stabilise it some coordinates in some points of geometry have to be locked. It can be understood as fixing the truss to the wall. The procedure is as follows:


<a id="fig:fix:displacement"/>
<div class="container">
	<div class="math below_pos hcenter_pos" style="left:300px;top:151px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:257px;top:108px;">$y$</div>
	<div class="math vcenter_pos left_pos" style="left:245px;top:160px;">$z$</div>
	<div class="math above_pos right_pos" style="left:351px;top:217px;">$p_0$</div>
	<div class="math above_pos hcenter_pos" style="left:348px;top:58px;">$p_1$</div>
	<div class="math below_pos hcenter_pos" style="left:527px;top:225px;">$p_2$</div>
	<div class="math below_pos left_pos" style="left:321px;top:247px;">$p_3$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="260" y1="148" x2="300" y2="148"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="260" y1="148" x2="260" y2="108"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="260" y1="148" x2="248" y2="160"/>
	<line stroke="black" x1="348" y1="220" x2="348" y2="61"/>
	<line stroke="black" x1="348" y1="61" x2="527" y2="222"/>
	<line stroke="black" x1="527" y1="222" x2="348" y2="220"/>
	<line stroke="black" x1="324" y1="244" x2="348" y2="220"/>
	<line stroke="black" x1="324" y1="244" x2="348" y2="61"/>
	<line stroke="black" x1="324" y1="244" x2="527" y2="222"/>
	<circle stroke="red" fill="red" cx="348" cy="220" r="3"/>
	<circle stroke="red" fill="red" cx="348" cy="61" r="3"/>
	<circle stroke="red" fill="red" cx="324" cy="244" r="3"/>
	<circle stroke="red" fill="red" cx="420" cy="90" r="3"/>
	<text  baseline-shift="-40%" x="423" y="90">Fixed Point Displacement</text>
</svg>
<p class="centered">Figure 6: Fixing Tetrahedron to the Wall</p>

Consider linear equations with exactly one solution

\begin{equation}
a_1 x_0 + b_1 x_1 + c_1 x_2 = d_1
\end{equation}
\begin{equation}
a_2 x_0 + b_2 x_1 + c_2 x_2 = d_2
\end{equation}
\begin{equation}
a_3 x_0 + b_3 x_1 + c_3 x_2 = d_3
\end{equation}

or

\begin{equation}
\begin{bmatrix}
	a_1 & b_1 & c_1 \\
	a_2 & b_2 & c_2 \\
	a_3 & b_3 & c_3
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	x_1 \\
	x_2
\end{bmatrix}
=
\begin{bmatrix}
	d_1 \\
	d_2 \\
	d_3
\end{bmatrix}
\end{equation}

Fixing a point displacement requires setting selected variable to zero (no point displacement in this direction). Let's choose $x_1=0$. In order to preserve equality the constant $d_2$ must be freed. Disregarding zeros and moving new variable to the left side we obtain:

\begin{equation}
a_1 x_0 + c_1 x_2 = d_1
\end{equation}
\begin{equation}
a_2 x_0 + c_2 x_2 - d_2 = 0
\end{equation}
\begin{equation}
a_3 x_0 + c_3 x_2 = d_3
\end{equation}

\begin{equation}
\begin{bmatrix}
	a_1 & 0 & c_1 \\
	a_2 & -1 & c_2 \\
	a_3 & 0 & c_3
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	d_2 \\
	x_2
\end{bmatrix}
=
\begin{bmatrix}
	d_1 \\
	0 \\
	d_3
\end{bmatrix}
\end{equation}

Concluding - in order to fix some degrees of freedom the corresponding column of the stiffness matrix has to be zeroed and a fixed variable replaced with -1. Corresponding cell in solution vector will hold <i>freed</i> constant.

<div class="shrink">
\begin{equation}

\begin{bmatrix}
\color{blue}{-1} & . & . & . & . & . & -222.2 & . & . & . & . & . \\
. & 250 & . & . & -250 & . & . & . & . & . & . & . \\
. & . & \color{blue}{-1} & . & . & . & . & . & . & . & . & . \\
. & . & . & \color{blue}{-1} & -82.47 & . & -92.78 & 82.47 & . & . & . & . \\
. & -250 & . & . & 366 & . & 82.47 & -73.31 & . & . & . & . \\
. & . & . & . & -64 & \color{blue}{-1} & . & . & . & . & . & . \\
. & . & . & . & 82.47 & . & 363 & -82.47 & -64 & . & . & . \\
. & . & . & . & -73.31 & . & -82.47 & 73.31 & . & . & . & . \\
. & . & . & . & . & . & -64 & . & 85.33 & . & . & . \\
. & . & . & . & . & . & -48 & . & 64 & \color{blue}{-1} & . & . \\
. & . & . & . & -42.67 & . & . & . & . & . & \color{blue}{-1} & . \\
. & . & . & . & 64 & . & 64 & . & -85.33 & . & . & \color{blue}{-1}
\end{bmatrix}
\begin{bmatrix}
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
. \\
.
\end{bmatrix}=
\begin{bmatrix}
. \\
. \\
. \\
. \\
. \\
. \\
. \\
30 \\
30 \\
. \\
. \\
.
\end{bmatrix}

\end{equation}
</div>

<h3 id="3070000">3.7. Implementation</h3>

<iframe src="populate.cpp"></iframe>

<h2 id="4070000">4. Solving Linear Equations by LU Decomposition Method</h2>

<h3 id="4010000">4.1. Explanation</h3>

The method takes advantage of the fact that solving equation where matrix is triangular is straightforward. All cells above (or below) diagonal are equal zero and solution can be achieved in one iteration. The method at first breaks down the matrix into a multiplication of 2 triangular ones and then calculates sub-equations as follows.

<br><br>

Consider linear equations with exactly one solution

\begin{equation}
a_1 x_0 + b_1 x_1 + c_1 x_2 = d_1
\end{equation}
\begin{equation}
a_2 x_0 + b_2 x_1 + c_2 x_2 = d_2
\end{equation}
\begin{equation}
a_3 x_0 + b_3 x_1 + c_3 x_2 = d_3
\end{equation}

or

\begin{equation}
\begin{bmatrix}
	a_1 & b_1 & c_1 \\
	a_2 & b_2 & c_2 \\
	a_3 & b_3 & c_3
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	x_1 \\
	x_2
\end{bmatrix}
=
\begin{bmatrix}
	d_1 \\
	d_2 \\
	d_3
\end{bmatrix}
\end{equation}

\begin{equation}
\mathbf{K} \Delta \mathbf{P} = \mathbf{F}
\end{equation}

LU Decomposition Method is one of the simplest, though memory hungry solver. Let's decompose matrix $\mathbf{A}$ into 2 triangular matrices LU (lower and upper).

\begin{equation}
\begin{bmatrix}
	a_1 & b_1 & c_1 \\
	a_2 & b_2 & c_2 \\
	a_3 & b_3 & c_3
\end{bmatrix}
=
\begin{bmatrix}
	1 & 0 & 0 \\
	\color{green}{l_{21}} & 1 & 0 \\
	\color{green}{l_{31}} & \color{green}{l_{32}} & 1
\end{bmatrix}
\begin{bmatrix}
	\color{blue}{u_{11}} & \color{blue}{u_{12}} & \color{blue}{u_{13}} \\
	0 & \color{blue}{u_{22}} & \color{blue}{u_{23}} \\
	0 & 0 & \color{blue}{u_{33}}
\end{bmatrix}
\end{equation}

The equation can be rewritten as

\begin{equation}
\mathbf{LU} \Delta \mathbf{P} = \mathbf{F}
\end{equation}

When L and U are calculated the auxiliary vector Z can be simply solved

\begin{equation}
\mathbf{LZ} = \mathbf{F}
\end{equation}

Finally the vector $\Delta \mathbf{P}$ can be solved in similar way

\begin{equation}
\mathbf{U} \Delta \mathbf{P} = \mathbf{Z}
\end{equation}

<h3 id="4020000">4.2. Solving an Example</h3>

Let's solve a simple example.

\begin{equation}
\begin{bmatrix}
	1 & 2 & 3 \\
	4 & 14 & 19 \\
	5 & 58 & 80
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	x_1 \\
	x_2
\end{bmatrix}
=
\begin{bmatrix}
	10 \\
	59 \\
	211
\end{bmatrix}
\end{equation}

LU Decomposition

\begin{equation}
\begin{bmatrix}
	1 & 2 & 3 \\
	4 & 14 & 19 \\
	5 & 58 & 80
\end{bmatrix}
=
\begin{bmatrix}
	1 & 0 & 0 \\
	l_{21} & 1 & 0 \\
	l_{31} & l_{32} & 1
\end{bmatrix}
\begin{bmatrix}
	u_{11} & u_{12} & u_{13} \\
	0 & u_{22} & u_{23} \\
	0 & 0 & u_{33}
\end{bmatrix}
\end{equation}

It can be noticed that general direction of solving cells of matrices L and U is as depicted on figure <a href="#fig:lu:direction">7</a>.

\begin{equation}
\begin{array}{lllll}
	1 = 1 * u_{11} & \Rightarrow & & \Rightarrow & \color{blue}{u_{11}} = 1 \\
	2 = 1 * u_{12} & \Rightarrow & & \Rightarrow & \color{blue}{u_{12}} = 2 \\
	3 = 1 * u_{13} & \Rightarrow & & \Rightarrow & \color{blue}{u_{13}} = 3 \\
	4 = l_{21}u_{11} & \Rightarrow & 4 = l_{21} * 1 & \Rightarrow & \color{green}{l_{21}} = 4 \\
	5 = l_{31}u_{11} & \Rightarrow & 5 = l_{31} * 1 & \Rightarrow & \color{green}{l_{31}} = 5 \\
	14 = l_{21}u_{12} + u_{22} & \Rightarrow & 14 = 4 * 2 + u_{22} & \Rightarrow & \color{blue}{u_{22}} = 6 \\
	19 = l_{21}u_{13} + u_{23} & \Rightarrow & 19 = 4 * 3 + u_{23} & \Rightarrow & \color{blue}{u_{23}} = 7 \\
	58 = l_{31}u_{12} + l_{32}u_{22} & \Rightarrow & 58 = 5 * 2 + l_{32} * 6 & \Rightarrow & \color{green}{l_{32}} = 8 \\
	80 = l_{31}u_{13} + l_{32}u_{23} + u_{33} & \Rightarrow & 80 = 5 * 3 + 8 * 7 + u_{33} & \Rightarrow & \color{blue}{u_{33}} = 9
\end{array}
\end{equation}


<a id="fig:lu:direction"/>
<div class="container">
</div>
<svg width="800" height="150">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<path stroke="black" d="M300 138 L291 138 L291 41 L300 41" fill="none"/>
	<line stroke="black" stroke-dasharray="7,7" marker-end=url(#arrow-end-black) x1="300" y1="50" x2="380" y2="130"/>
	<line stroke="black" stroke-dasharray="7,7" marker-end=url(#arrow-end-black) x1="300" y1="50" x2="300" y2="130"/>
	<line stroke="black" stroke-dasharray="7,7" marker-end=url(#arrow-end-black) x1="340" y1="90" x2="340" y2="130"/>
	<path stroke="black" d="M380 138 L388 138 L388 41 L380 41" fill="none"/>
	<path stroke="black" d="M420 138 L411 138 L411 41 L420 41" fill="none"/>
	<line stroke="black" stroke-dasharray="7,7" marker-end=url(#arrow-end-black) x1="420" y1="50" x2="500" y2="130"/>
	<line stroke="black" stroke-dasharray="7,7" marker-end=url(#arrow-end-black) x1="420" y1="50" x2="500" y2="50"/>
	<line stroke="black" stroke-dasharray="7,7" marker-end=url(#arrow-end-black) x1="460" y1="90" x2="500" y2="90"/>
	<path stroke="black" d="M500 138 L508 138 L508 41 L500 41" fill="none"/>
</svg>
<p class="centered">Figure 7: Direction of the Decomposition in Matrices L and U</p>

Verification of LU Decomposition

\begin{equation}
\begin{bmatrix}
	1 & 2 & 3 \\
	4 & 14 & 19 \\
	5 & 58 & 80
\end{bmatrix}
=
\begin{bmatrix}
	1 & 0 & 0 \\
	4 & 1 & 0 \\
	5 & 8 & 1
\end{bmatrix}
\begin{bmatrix}
	1 & 2 & 3 \\
	0 & 6 & 7 \\
	0 & 0 & 9
\end{bmatrix}
\end{equation}

Solving the auxiliary Z vector

\begin{equation}
\begin{bmatrix}
	1 & 0 & 0 \\
	4 & 1 & 0 \\
	5 & 8 & 1
\end{bmatrix}
\begin{bmatrix}
	z_0 \\
	z_1 \\
	z_2
\end{bmatrix}
=
\begin{bmatrix}
	10 \\
	59 \\
	211
\end{bmatrix}
\end{equation}

\begin{equation}
\begin{array}{llllll}
	1 * z_0 = 10 & \Rightarrow & & \Rightarrow & z_0 = 10 \\
	4 * z_0 + 1 * z_1 = 59 & \Rightarrow & 4 * 10 + z_1 = 59 & \Rightarrow & z_1 = 19 \\
	5 * z_0 + 8 * z_1 + 1 * z_2 = 211 & \Rightarrow & 5 * 10 + 8 * 19 + 1 * z_2 = 211 & \Rightarrow & z_2 = 9
\end{array}
\end{equation}

Verification

\begin{equation}
\begin{bmatrix}
	1 & 0 & 0 \\
	4 & 1 & 0 \\
	5 & 8 & 1
\end{bmatrix}
\begin{bmatrix}
	10 \\
	19 \\
	9
\end{bmatrix}
=
\begin{bmatrix}
	10 \\
	59 \\
	211
\end{bmatrix}
\end{equation}

The final solution

\begin{equation}
\begin{bmatrix}
	1 & 2 & 3 \\
	0 & 6 & 7 \\
	0 & 0 & 9
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	x_1 \\
	x_2
\end{bmatrix}
=
\begin{bmatrix}
	10 \\
	19 \\
	9
\end{bmatrix}
\end{equation}

\begin{equation}
\begin{array}{llllll}
	9 * x_2 = 9 & \Rightarrow & & \Rightarrow & x_2 = 1 \\
	6 * x_1 + 7 * x_2 = 19 & \Rightarrow & 6 * x_1 + 7 * 1 = 19 & \Rightarrow & x_1 = 2 \\
	1 * x_0 + 2 * x_1 + 3 * x_2 = 10 & \Rightarrow & 1 * x_0 + 2 * 2 + 3 * 1 = 10 & \Rightarrow & x_0 = 3
\end{array}
\end{equation}

Verification

\begin{equation}
\begin{bmatrix}
	1 & 2 & 3 \\
	0 & 6 & 7 \\
	0 & 0 & 9
\end{bmatrix}
\begin{bmatrix}
	3 \\
	2 \\
	1
\end{bmatrix}
=
\begin{bmatrix}
	10 \\
	19 \\
	9
\end{bmatrix}
\end{equation}

Final verification of the original equation

\begin{equation}
\begin{bmatrix}
	1 & 2 & 3 \\
	4 & 14 & 19 \\
	5 & 58 & 80
\end{bmatrix}
\begin{bmatrix}
	3 \\
	2 \\
	1
\end{bmatrix}
=
\begin{bmatrix}
	10 \\
	59 \\
	211
\end{bmatrix}
\end{equation}

<h3 id="4030000">4.3. Pitfalls of Direct Methods</h3>

The present example uses LU Decomposition for solving matrix equations. The main downside of such approach is that data blocks are composed mostly with zeros. It is very inefficient management of memory and can be used only for simple geometries. Bigger examples may not fit into memory of modern computers.
More realistic model should be solved by one of sparse matrix methods. The most promising of them is Conjugate Gradient Method. Further work on next version of this document will be focused on it.

<h3 id="4040000">4.4. The Concrete Example Result Presentation</h3>

The below matrix equation presents the stiffness matrix, the displacement vector and external forces applied in selected points. Some cells where $-1$ is shown are used for fixed displacements and were chosen to compute reaction forces in corresponding displacement vector. The simplicity dictates such approach for price of loosing symmetry of matrix.

<br><br>

The data in the form

\begin{equation}
\mathbf{K} \Delta \mathbf{P} = \mathbf{F}
\end{equation}

is generated below as a result of computation of the main example

<div class="shrink">
\begin{equation}

\begin{bmatrix}
\color{blue}{-1} & . & . & . & . & . & -222.2 & . & . & . & . & . \\
. & 250 & . & . & -250 & . & . & . & . & . & . & . \\
. & . & \color{blue}{-1} & . & . & . & . & . & . & . & . & . \\
. & . & . & \color{blue}{-1} & -82.47 & . & -92.78 & 82.47 & . & . & . & . \\
. & -250 & . & . & 366 & . & 82.47 & -73.31 & . & . & . & . \\
. & . & . & . & -64 & \color{blue}{-1} & . & . & . & . & . & . \\
. & . & . & . & 82.47 & . & 363 & -82.47 & -64 & . & . & . \\
. & . & . & . & -73.31 & . & -82.47 & 73.31 & . & . & . & . \\
. & . & . & . & . & . & -64 & . & 85.33 & . & . & . \\
. & . & . & . & . & . & -48 & . & 64 & \color{blue}{-1} & . & . \\
. & . & . & . & -42.67 & . & . & . & . & . & \color{blue}{-1} & . \\
. & . & . & . & 64 & . & 64 & . & -85.33 & . & . & \color{blue}{-1}
\end{bmatrix}
\begin{bmatrix}
\color{blue}{-56.25} \\
0.7031 \\
. \\
\color{blue}{33.75} \\
0.7031 \\
\color{blue}{-45} \\
0.2531 \\
1.397 \\
0.5414 \\
\color{blue}{22.5} \\
\color{blue}{-30} \\
\color{blue}{15}
\end{bmatrix}=
\begin{bmatrix}
. \\
. \\
. \\
. \\
. \\
. \\
. \\
30 \\
30 \\
. \\
. \\
.
\end{bmatrix}

\end{equation}
</div>

<h3 id="4050000">4.5. Implementation of LU Decomposition Method</h3>

<iframe src="calculate.cpp"></iframe>

<h2 id="5050000">5. The 3D Data Presentation in the Documentation</h2>

This chapter tries to explain how to present three-dimensional data in the document. Using only $x,y$ and removing $z$ coordinate is not a good solution since we loose part of the information and presented figures are not clear. Rotation is much better as all of original coordinates can be used and after transformation the new coordinate $z'$ can be discarded without loosing general understanding.

<h3 id="5010000">5.1. Point Rotation</h3>

Let's consider rotation of a point in coordinates x, y


<a id="fig:point:rotation"/>
<div class="container">
	<div class="math above_pos hcenter_pos" style="left:470px;top:227px;">$x$</div>
	<div class="math vcenter_pos right_pos" style="left:253px;top:50px;">$y$</div>
	<div class="math above_pos hcenter_pos" stroke="red" style="left:343px;top:192px;">$r$</div>
	<div class="math vcenter_pos right_pos" style="left:440px;top:161px;">$(x_0,y_0)$</div>
	<div class="math above_pos hcenter_pos" stroke="red" style="left:312px;top:148px;">$r$</div>
	<div class="math vcenter_pos right_pos" style="left:377px;top:73px;">$(x_1,y_1)$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:328px;top:216px;">$\alpha_0$</div>
	<div class="math vcenter_pos hcenter_pos" style="left:298px;top:194px;">$\alpha_1$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M250 50 L250 230 L470 230" fill="none"/>
	<path stroke="black" stroke-dasharray="7,7" d="M250 161 L437 161 L437 230" fill="none"/>
	<path stroke="black" stroke-dasharray="7,7" d="M250 73 L374 73 L374 230" fill="none"/>
	<line stroke="red" x1="250" y1="230" x2="437" y2="161"/>
	<circle stroke="black" fill="black" cx="437" cy="161" r="3"/>
	<line stroke="red" stroke-dasharray="7,7" x1="250" y1="230" x2="374" y2="73"/>
	<circle stroke="black" fill="black" cx="374" cy="73" r="3"/>
	<path fill="none" stroke="black" d="M310 230 A60 60 0 0 0 306 209"/>
	<path fill="none" stroke="black" marker-end=url(#arrow-end-black) d="M325 202 A80 80 0 0 0 299 167"/>
</svg>
<p class="centered">Figure 8: Point Rotation</p>

From geometry on the figure <a href="#fig:point:rotation">8</a> we can obtain

\begin{equation}
x_0 = r \cos \alpha_0
\end{equation}
\begin{equation}
y_0 = r \sin \alpha_0
\end{equation}
\begin{equation}
x_1 = r \cos (\alpha_0 + \alpha_1) = r \cos \alpha_0 \cos \alpha_1 - r \sin \alpha_0 \sin \alpha_1
\end{equation}
\begin{equation}
y_1 = r \sin (\alpha_0 + \alpha_1) = r \sin \alpha_0 \cos \alpha_1 + r \cos \alpha_0 \sin \alpha_1
\end{equation}

hence

\begin{equation}
x_1 = x_0 \cos \alpha_1 - y_0 \sin \alpha_1
\end{equation}
\begin{equation}
y_1 = x_0 \sin \alpha_1 + y_0 \cos \alpha_1
\end{equation}

Changes on the axis z can be expressed simply by $z_1 = z_0$. Constructing three-dimensional matrix we obtain rotation operator around the axis z

\begin{equation}
\begin{bmatrix}
	x_1 \\
	y_1 \\
	z_1
\end{bmatrix}
=
\begin{bmatrix}
	\cos \alpha_1 & - \sin \alpha_1 & 0 \\
	\sin \alpha_1 & \cos \alpha_1 & 0 \\
	0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	y_0 \\
	z_0
\end{bmatrix}
\end{equation}

\begin{equation}
\mathbf{P_1} = \mathbf{R_z P_0}
\end{equation}

<h3 id="5020000">5.2. An Example of Rotated Tetrahedron</h3>

The example rotates all points of geometry around the axis y and then x. It can be expressed as

\begin{equation}
\mathbf{P_1} = \mathbf{R_x R_y P_0}
\end{equation}

In details

\begin{equation}
\begin{bmatrix}
	x_1 \\
	y_1 \\
	z_1
\end{bmatrix}
=
\begin{bmatrix}
	1 & 0 & 0 \\
	0 & c_x & -s_x \\
	0 & s_x & c_x
\end{bmatrix}
\begin{bmatrix}
	c_y & 0 & -s_y \\
	0 & 1 & 0 \\
	s_y & 0 & c_y
\end{bmatrix}
\end{equation}

\begin{equation}
\begin{bmatrix}
	x_1 \\
	y_1 \\
	z_1
\end{bmatrix}
=
\begin{bmatrix}
	c_y & 0 & -s_y \\
	-s_xs_y & c_x & -s_xc_y \\
	c_xs_y & s_x & c_xc_y
\end{bmatrix}
\begin{bmatrix}
	x_0 \\
	y_0 \\
	z_0
\end{bmatrix}
\end{equation}

Finally the coordinate $z_1$ is cut off as it does not have representation in 2D. Visualized results are presented on the figure <a href="#fig:object:rotation">9</a>.


<a id="fig:object:rotation"/>
<div class="container">
	<div class="math vcenter_pos left_pos" style="left:297px;top:90px;">$y$</div>
	<div class="math below_pos hcenter_pos" style="left:300px;top:133px;">$z=0$</div>
	<div class="math below_pos hcenter_pos" style="left:340px;top:133px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:137px;top:230px;">$p_0$</div>
	<div class="math vcenter_pos left_pos" style="left:137px;top:70px;">$p_1$</div>
	<div class="math below_pos hcenter_pos" style="left:320px;top:233px;">$p_2$</div>
	<div class="math below_pos hcenter_pos" style="left:140px;top:233px;">$p_3$</div>
	<div class="math below_pos hcenter_pos" style="left:619px;top:130px;">$x$</div>
	<div class="math vcenter_pos left_pos" style="left:576px;top:87px;">$y$</div>
	<div class="math vcenter_pos left_pos" style="left:564px;top:138px;">$z$</div>
	<div class="math above_pos right_pos" style="left:431px;top:217px;">$p_0'$</div>
	<div class="math vcenter_pos left_pos" style="left:425px;top:61px;">$p_1'$</div>
	<div class="math below_pos hcenter_pos" style="left:607px;top:225px;">$p_2'$</div>
	<div class="math below_pos hcenter_pos" style="left:404px;top:247px;">$p_3'$</div>
</div>
<svg width="800" height="300">
	<defs>
		<marker id="arrow-start-black" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-end-black" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="black" fill="black"/>
		</marker>
		<marker id="arrow-start-red" markerWidth="13" markerHeight="13" refx="0" refy="4" orient="auto">
			<path d="M12,0 L12,8 L0,4 z" stroke="red" fill="red"/>
		</marker>
		<marker id="arrow-end-red" markerWidth="13" markerHeight="13" refx="12" refy="4" orient="auto">
			<path d="M0,0 L0,8 L12,4 z" stroke="red" fill="red"/>
		</marker>
	</defs>
	<text  baseline-shift="-40%" text-anchor="middle" x="220" y="70">a) Original</text>
	<path stroke="black" marker-start=url(#arrow-start-black) marker-end=url(#arrow-end-black) d="M300 90 L300 130 L340 130" fill="none"/>
	<line stroke="black" x1="140" y1="230" x2="140" y2="70"/>
	<line stroke="black" x1="140" y1="70" x2="320" y2="230"/>
	<line stroke="black" x1="320" y1="230" x2="140" y2="230"/>
	<line stroke="black" x1="140" y1="230" x2="140" y2="230"/>
	<line stroke="black" x1="140" y1="230" x2="140" y2="70"/>
	<line stroke="black" x1="140" y1="230" x2="320" y2="230"/>
	<text  baseline-shift="-40%" text-anchor="middle" x="500" y="70">b) Rotated</text>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="579" y1="126" x2="619" y2="127"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="579" y1="126" x2="579" y2="87"/>
	<line stroke="black" marker-end=url(#arrow-end-black) x1="579" y1="126" x2="567" y2="138"/>
	<line stroke="black" x1="428" y1="220" x2="428" y2="61"/>
	<line stroke="black" x1="428" y1="61" x2="607" y2="222"/>
	<line stroke="black" x1="607" y1="222" x2="428" y2="220"/>
	<line stroke="black" x1="404" y1="244" x2="428" y2="220"/>
	<line stroke="black" x1="404" y1="244" x2="428" y2="61"/>
	<line stroke="black" x1="404" y1="244" x2="607" y2="222"/>
</svg>
<p class="centered">Figure 9: Original and Rotated Tetrahedron Example</p>

<h3 id="5030000">5.3. Implementation of the Rotation Procedure</h3>

<iframe src="rotate.cpp"></iframe>

<h2 id="6030000">6. Summary</h2>

Finally the article described all practical aspects of the finite method presentation. Starting with geometry definition, theoretical method explanation, solving matrix equations and 3D data presentation. Reader could confront mathematical aspects with practical implementation for better understanding.

</div>
</body>
</html>
